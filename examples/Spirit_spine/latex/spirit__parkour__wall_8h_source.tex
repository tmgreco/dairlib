\hypertarget{spirit__parkour__wall_8h_source}{}\doxysection{spirit\+\_\+parkour\+\_\+wall.\+h}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef \_spirit\_parkour\_wall}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define \_spirit\_parkour\_wall}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <cmath>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <experimental/filesystem>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <filesystem>}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include "{}common/find\_resource.h"{}}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include "{}systems/trajectory\_optimization/dircon/dircon.h"{}}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include "{}multibody/kinematic/world\_point\_evaluator.h"{}}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include "{}solvers/nonlinear\_constraint.h"{}}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include "{}multibody/kinematic/distance\_evaluator.h"{}}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include "{}multibody/multibody\_utils.h"{}}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include "{}multibody/visualization\_utils.h"{}}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include "{}multibody/kinematic/kinematic\_constraints.h"{}}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include "{}examples/Spirit/animate\_spirit.h"{}}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include "{}common/file\_utils.h"{}}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include "{}lcm/dircon\_saved\_trajectory.h"{}}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include "{}solvers/optimization\_utils.h"{}}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include "{}solvers/nonlinear\_cost.h"{}}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include "{}examples/Spirit/spirit\_utils.h"{}}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#include "{}examples/Spirit/behavior.h"{}}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include "{}examples/Spirit/spirit\_optimal\_stand.h"{}}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 }
\DoxyCodeLine{28 \textcolor{keyword}{using} drake::multibody::MultibodyPlant;}
\DoxyCodeLine{29 \textcolor{keyword}{using} drake::trajectories::PiecewisePolynomial;}
\DoxyCodeLine{30 \textcolor{keyword}{namespace }dairlib \{}
\DoxyCodeLine{31     \textcolor{keyword}{using} systems::trajectory\_optimization::Dircon;}
\DoxyCodeLine{32 }
\DoxyCodeLine{33 }
\DoxyCodeLine{34 \textcolor{keyword}{template} <\textcolor{keyword}{class} Y>  }
\DoxyCodeLine{35 \textcolor{keyword}{class }\mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk}{SpiritParkourWallPronk}} : \textcolor{keyword}{public} \mbox{\hyperlink{classdairlib_1_1Behavior}{Behavior}}<Y> \{}
\DoxyCodeLine{36 \textcolor{keyword}{public}:}
\DoxyCodeLine{37 }
\DoxyCodeLine{38     \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk}{SpiritParkourWallPronk}}();}
\DoxyCodeLine{44     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_adff739e009c00c2f4f191558f57fa157}{config}}(std::string yaml\_path, std::string saved\_directory, \textcolor{keywordtype}{int} index,MultibodyPlant<Y>* \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_ad308423967b977ed6a52523910b48d4c}{plant}});}
\DoxyCodeLine{45     }
\DoxyCodeLine{53     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_a85d96d2d2aaf3cc8e5587809259dba95}{offsetConstraint}}(}
\DoxyCodeLine{54         MultibodyPlant<Y>\& \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_ad308423967b977ed6a52523910b48d4c}{plant}},}
\DoxyCodeLine{55         dairlib::systems::trajectory\_optimization::Dircon<Y>\& trajopt,}
\DoxyCodeLine{56         \textcolor{keyword}{const} Eigen::Ref<const drake::solvers::VectorXDecisionVariable>\& xb,}
\DoxyCodeLine{57         Eigen::Vector3d normal,}
\DoxyCodeLine{58         Eigen::Vector3d offset,}
\DoxyCodeLine{59         \textcolor{keywordtype}{double} eps2 = 0.01}
\DoxyCodeLine{60         );}
\DoxyCodeLine{62     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_ace881223a3611940432acf4cbdbe88a7}{generateInitialGuess}}(MultibodyPlant<Y>\& \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_ad308423967b977ed6a52523910b48d4c}{plant}});}
\DoxyCodeLine{63 }
\DoxyCodeLine{64 }
\DoxyCodeLine{65     \textcolor{keywordtype}{void} concatVectorTraj(}
\DoxyCodeLine{66         vector<PiecewisePolynomial<Y>>\& traj, }
\DoxyCodeLine{67         vector<PiecewisePolynomial<Y>> otherTraj, }
\DoxyCodeLine{68         \textcolor{keywordtype}{bool} mergeInnerMode);}
\DoxyCodeLine{72     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_a7a3c14cdf272e4b98246cf2209c960b2}{addConstraints}}(MultibodyPlant<Y>\& \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_ad308423967b977ed6a52523910b48d4c}{plant}}, }
\DoxyCodeLine{73                         dairlib::systems::trajectory\_optimization::Dircon<Y>\& trajopt}
\DoxyCodeLine{74                         );}
\DoxyCodeLine{75 }
\DoxyCodeLine{80     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_a7118a9c4d5a2bc88f36b266a59bab785}{run}}(MultibodyPlant<Y>\& \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_ad308423967b977ed6a52523910b48d4c}{plant}},}
\DoxyCodeLine{81             PiecewisePolynomial<Y>* pp\_xtraj,}
\DoxyCodeLine{82             std::vector<SurfaceConf>* surface\_vector);}
\DoxyCodeLine{83 }
\DoxyCodeLine{84     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_a5e9d3c7c225bfb063d73f3939ebb9350}{setUpModeSequence}}();}
\DoxyCodeLine{85 }
\DoxyCodeLine{89     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_ac852a9808a2ef3bbfff105f7aad8f0e6}{addCost}}(}
\DoxyCodeLine{90             MultibodyPlant<Y>\& \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_ad308423967b977ed6a52523910b48d4c}{plant}},}
\DoxyCodeLine{91             dairlib::systems::trajectory\_optimization::Dircon<Y>\& trajopt);}
\DoxyCodeLine{95     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_aded03d5934f085c4d0aee0333943f0c5}{addCostLegs}}(MultibodyPlant<Y>\& \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_ad308423967b977ed6a52523910b48d4c}{plant}},}
\DoxyCodeLine{96                  dairlib::systems::trajectory\_optimization::Dircon<Y>\& trajopt,}
\DoxyCodeLine{97                  \textcolor{keyword}{const} \textcolor{keywordtype}{double} \mbox{\hyperlink{classdairlib_1_1Behavior_afdae406f744ef4778b050ef5fabc1334}{cost\_actuation}},}
\DoxyCodeLine{98                  \textcolor{keyword}{const} \textcolor{keywordtype}{double} \mbox{\hyperlink{classdairlib_1_1Behavior_a24fe00801a0924f2f18b9342189518d7}{cost\_velocity}},}
\DoxyCodeLine{99                  \textcolor{keyword}{const} std::vector<double>\& joints,}
\DoxyCodeLine{100                  \textcolor{keyword}{const} \textcolor{keywordtype}{int} mode\_index);}
\DoxyCodeLine{101 }
\DoxyCodeLine{102     std::tuple<  std::vector<std::unique\_ptr<dairlib::systems::trajectory\_optimization::DirconMode<Y>>>,}
\DoxyCodeLine{103     std::vector<std::unique\_ptr<multibody::WorldPointEvaluator<Y>>> ,}
\DoxyCodeLine{104     std::vector<std::unique\_ptr<multibody::KinematicEvaluatorSet<Y>>>>}
\DoxyCodeLine{105     \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_ac7dd5c331a7746a66621ee246739ccd5}{getModeSequence}}(MultibodyPlant<Y>\& \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_ad308423967b977ed6a52523910b48d4c}{plant}},}
\DoxyCodeLine{106                     DirconModeSequence<Y>\& sequence)\{}
\DoxyCodeLine{107     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0;i<\mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_a8fb2d369686fea69936008d5a8890a12}{nJumps}}*5+1;i++)\{}
\DoxyCodeLine{108         \textcolor{keywordflow}{if} (i\%5==3 || i\%5==4) this-\/>\mbox{\hyperlink{classdairlib_1_1Behavior_aeb1ca35688639cd793f5f5dce641d82a}{num\_knot\_points}}.push\_back(\mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_a522831a4417f7e7e8f8f09a08fd239e2}{nKnotpoints\_flight}});}
\DoxyCodeLine{109         \textcolor{keywordflow}{else} this-\/>\mbox{\hyperlink{classdairlib_1_1Behavior_aeb1ca35688639cd793f5f5dce641d82a}{num\_knot\_points}}.push\_back(\mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_a5f33a62d8986bf9811e3f7dc1d126f70}{nKnotpoints\_stances}});}
\DoxyCodeLine{110     \}}
\DoxyCodeLine{111     }
\DoxyCodeLine{112     \mbox{\hyperlink{classdairlib_1_1ModeSequenceHelper}{dairlib::ModeSequenceHelper}} msh;}
\DoxyCodeLine{113     this-\/>\mbox{\hyperlink{classdairlib_1_1Behavior_adc15934596e6b9c0b2b20ab846aa3ba5}{getModeSequenceHelper}}(msh);}
\DoxyCodeLine{114 }
\DoxyCodeLine{115     \textcolor{keyword}{auto} [modeVector, toeEvals, toeEvalSets] = createSpiritModeSequence(\mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_ad308423967b977ed6a52523910b48d4c}{plant}}, msh);}
\DoxyCodeLine{116 }
\DoxyCodeLine{117     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& mode : modeVector)\{}
\DoxyCodeLine{118         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < mode-\/>evaluators().num\_evaluators(); i++ )\{}
\DoxyCodeLine{119         mode-\/>MakeConstraintRelative(i,0);}
\DoxyCodeLine{120         mode-\/>MakeConstraintRelative(i,1);}
\DoxyCodeLine{121         \}}
\DoxyCodeLine{122         mode-\/>SetDynamicsScale(}
\DoxyCodeLine{123             \{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19\}, 150.0);}
\DoxyCodeLine{124         \textcolor{keywordflow}{if} (mode-\/>evaluators().num\_evaluators() == 4)}
\DoxyCodeLine{125         \{}
\DoxyCodeLine{126         mode-\/>SetKinVelocityScale(}
\DoxyCodeLine{127             \{0, 1, 2, 3\}, \{0, 1, 2\}, 1.0);}
\DoxyCodeLine{128         mode-\/>SetKinPositionScale(}
\DoxyCodeLine{129             \{0, 1, 2, 3\}, \{0, 1, 2\}, 150.0);}
\DoxyCodeLine{130         \}}
\DoxyCodeLine{131         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (mode-\/>evaluators().num\_evaluators() == 2)\{}
\DoxyCodeLine{132         mode-\/>SetKinVelocityScale(}
\DoxyCodeLine{133             \{0, 1\}, \{0, 1, 2\}, 1.0);}
\DoxyCodeLine{134         mode-\/>SetKinPositionScale(}
\DoxyCodeLine{135             \{0, 1\}, \{0, 1, 2\}, 150.0);}
\DoxyCodeLine{136         \}}
\DoxyCodeLine{137         sequence.AddMode(mode.get());}
\DoxyCodeLine{138     \}}
\DoxyCodeLine{139     \textcolor{keywordflow}{return} \{std::move(modeVector), std::move(toeEvals), std::move(toeEvalSets)\};}
\DoxyCodeLine{140     \}}
\DoxyCodeLine{141 }
\DoxyCodeLine{142 \textcolor{keyword}{private}:}
\DoxyCodeLine{143 }
\DoxyCodeLine{144     std::unique\_ptr<MultibodyPlant<Y>> \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_ad308423967b977ed6a52523910b48d4c}{plant}}; }
\DoxyCodeLine{145     std::vector<std::tuple<Eigen::Vector3d,Eigen::Vector3d,double>> \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_abf82ae093359c9a9b29337430612f7c0}{transitionSurfaces}}; }
\DoxyCodeLine{146     }
\DoxyCodeLine{147     \textcolor{keywordtype}{int} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_a522831a4417f7e7e8f8f09a08fd239e2}{nKnotpoints\_flight}}; }
\DoxyCodeLine{148     \textcolor{keywordtype}{int} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_a5f33a62d8986bf9811e3f7dc1d126f70}{nKnotpoints\_stances}}; }
\DoxyCodeLine{149 }
\DoxyCodeLine{150 }
\DoxyCodeLine{151     \textcolor{keywordtype}{double} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_af6912d675e412f80a91773d87031505b}{max\_apex\_pitch\_magnitude}}; }
\DoxyCodeLine{152     \textcolor{keywordtype}{double} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_a45c94beb12b31d3f977321d135134f69}{max\_pitch\_magnitude}}; }
\DoxyCodeLine{153     \textcolor{keywordtype}{double} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_a9201856ed1773943289c69370311561c}{initial\_height}}; }
\DoxyCodeLine{154     \textcolor{keywordtype}{double} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_a57d15dc8a688d44bf5190fc59dffd7f6}{fore\_aft\_displacement}}; }
\DoxyCodeLine{155     \textcolor{keywordtype}{bool} lock\_rotation;}
\DoxyCodeLine{156     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_ab20cdab9770f460371e113cd28323407}{lock\_legs\_apex}}; }
\DoxyCodeLine{157     \textcolor{keywordtype}{bool} force\_symmetry;}
\DoxyCodeLine{158     \textcolor{keywordtype}{bool} use\_nominal\_stand;}
\DoxyCodeLine{159     \textcolor{keywordtype}{double} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_aa00b9af51f4d5580ff1a4b54ea372f6f}{max\_duration}}; }
\DoxyCodeLine{160     \textcolor{keywordtype}{double} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_a058e349624ba54399c5aa42200570190}{eps}};  }
\DoxyCodeLine{161     \textcolor{keywordtype}{double} work\_constraint\_scale;}
\DoxyCodeLine{162     \textcolor{keywordtype}{int} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_a8fb2d369686fea69936008d5a8890a12}{nJumps}}; }
\DoxyCodeLine{163     \textcolor{keywordtype}{double} \mbox{\hyperlink{classdairlib_1_1SpiritParkourWallPronk_a7cf88eb336b2307bff37362aa755713f}{xtol}}; }
\DoxyCodeLine{164     std::vector<double> apex\_heights;}
\DoxyCodeLine{165 \textcolor{keyword}{public}:}
\DoxyCodeLine{166     \mbox{\hyperlink{classdairlib_1_1OptimalSpiritStand}{dairlib::OptimalSpiritStand}} initialStand;}
\DoxyCodeLine{167     \mbox{\hyperlink{classdairlib_1_1OptimalSpiritStand}{dairlib::OptimalSpiritStand}} finalStand;}
\DoxyCodeLine{168 \};}
\DoxyCodeLine{169 \}}
\DoxyCodeLine{170 }
\DoxyCodeLine{171 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{172 }

\end{DoxyCode}
